# SleepCycle-Alarm Project Guide

## Project Overview
Sleep cycle calculator API that helps users find optimal bedtimes based on sleep cycles (~90 min), sleep latency, and wake time.

## Tech Stack
- **Backend**: FastAPI (Python 3.11+)
- **Frontend**: Simple HTML/CSS/JS (future: Flutter mobile app)
- **Testing**: pytest with coverage
- **Deployment**: Docker + docker-compose
- **Database**: SQLite for MVP (future: PostgreSQL)

## Project Structure
```
.
├── backend/
│   ├── app/
│   │   ├── __init__.py
│   │   ├── main.py              # FastAPI app entry point
│   │   ├── models.py            # Pydantic models
│   │   ├── calculator.py        # Core sleep cycle algorithm
│   │   └── routes/
│   │       ├── __init__.py
│   │       ├── calculate.py     # Calculation endpoints
│   │       └── preferences.py   # User preferences endpoints
│   ├── tests/
│   │   ├── __init__.py
│   │   ├── test_calculator.py   # Algorithm tests (TDD)
│   │   └── test_api.py          # API integration tests
│   ├── requirements.txt
│   ├── Dockerfile
│   └── pytest.ini
├── frontend/
│   ├── index.html
│   ├── styles.css
│   └── app.js
├── docker-compose.yml
├── .gitignore
├── README.md
└── CLAUDE.md
```

## Development Workflow

### Running the App
```bash
# Backend only (development)
cd backend
pip install -r requirements.txt
uvicorn app.main:app --reload --port 8000

# Full stack with Docker
docker-compose up --build

# Run tests
cd backend
pytest -v --cov=app
```

### Testing Strategy (TDD for Core Logic)
1. **Calculator module**: Full TDD - write tests first, then implement
2. **API endpoints**: Test after implementation
3. **Frontend**: Manual testing + future e2e tests

### Code Style
- **Python**: Follow PEP 8, use type hints everywhere
- **Max line length**: 100 characters
- **Docstrings**: Google style for functions
- **Naming**: snake_case for Python, camelCase for JavaScript

### Key Algorithms

#### Sleep Cycle Calculation
```
bedtime = wake_time - (num_cycles * cycle_length_min) - sleep_latency_min
total_sleep = (num_cycles * cycle_length_min) + sleep_latency_min
```

**Parameters**:
- `wake_time`: Target wake time (HH:MM)
- `sleep_latency_min`: Time to fall asleep (default: 15 min)
- `cycle_length_min`: Sleep cycle duration (default: 90 min, range: 60-110)
- `min_cycles`: Minimum cycles to calculate (default: 4)
- `max_cycles`: Maximum cycles to calculate (default: 6)

**Validation Rules**:
- Sleep latency: 0-60 minutes
- Cycle length: 60-110 minutes
- Number of cycles: 1-10
- Recommended minimum: 4-5 cycles (6-7.5 hours)

### Git Workflow
- Use descriptive commit messages
- Test before committing
- Small, atomic commits preferred

### Environment Variables
```bash
# Backend (.env file)
API_PORT=8000
CORS_ORIGINS=http://localhost:3000,http://localhost:8080
DEBUG=true
```

## Tips for First-Time Developers

### Understanding the Architecture
1. **Backend (FastAPI)**: Handles business logic, calculations, data validation
2. **Frontend (Web)**: User interface, calls backend API via HTTP
3. **Docker**: Packages everything so it runs the same everywhere

### Key Concepts
- **API**: Application Programming Interface - how frontend talks to backend
- **REST**: Architecture style using HTTP methods (GET, POST, PUT, DELETE)
- **CORS**: Cross-Origin Resource Sharing - allows frontend on different port to call API
- **Pydantic**: Python library for data validation using type hints
- **pytest**: Testing framework that runs automated tests

### Development Tips
1. Start backend first, test with curl or Postman
2. Add one feature at a time
3. Run tests frequently: `pytest -v`
4. Check API docs at: http://localhost:8000/docs (auto-generated by FastAPI!)
5. Use browser console (F12) to debug frontend JavaScript

### Common Commands
```bash
# See what's running
docker-compose ps

# View logs
docker-compose logs -f backend

# Stop everything
docker-compose down

# Rebuild after code changes
docker-compose up --build

# Run single test
pytest tests/test_calculator.py::test_basic_calculation -v
```

## Future Enhancements
- [ ] User authentication (JWT)
- [ ] PostgreSQL database
- [ ] Flutter mobile app with native alarm integration
- [ ] Historical sleep data tracking
- [ ] Smart cycle length estimation based on user data
- [ ] Dark mode
- [ ] Internationalization (i18n) - Italian support

## Resources
- FastAPI docs: https://fastapi.tiangolo.com
- Pytest docs: https://docs.pytest.org
- Sleep cycle research: https://www.sleepfoundation.org/
